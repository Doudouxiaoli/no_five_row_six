<!DOCTYPE html>
#@pc_layout()
#define title()
<title>登录</title>
#end
#define css()
#end
#define js()
#end
#define main()
<div class="main-w3layouts wrapper">
    <h1>五排六号手机号登录</h1>
    <div class="main-agileinfo">
        <div class="agileits-top">
            <form action="/api/user/forgetPassword" method="post">
                <input class="text" type="text" name="fuPhone" id="fuPhone" placeholder="电话" required="">
                <input class="text" type="text" style="display: inline-block;width: 60%" name="scCode" placeholder="验证码"
                       required="" id="scCode">
                <button type="button" id="getCode">获取验证码</button>
                <div class="wthree-text">
                    <ul>
                        <li>手机号已失效?<a href="/api/user/registerInit">注册</a></li>
                    </ul>
                    <div class="clear"></div>
                </div>
                <input type="submit" value="登录" id="loginBtn2">
            </form>
        </div>
    </div>
    <!-- copyright -->
    <div class="w3copyright-agile">
        <p>© 2017 Magical Login Form . All rights <a href="http://www.bootstrapmb.com/" title="bootstrapmb">Reserved</a>
        </p>
    </div>
    <!-- //copyright -->
    <ul class="w3lsg-bubbles">
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
    </ul>
</div>
<script type="text/javascript">
    //观察手机号输入框数字变化
    $("#fuPhone").on("input", function (e) {
        $('#getCode').attr('disabled', "true");
        if ((/^1[3456789]\d{9}$/.test(e.delegateTarget.value))) {
            $('#getCode').removeAttr("disabled");
        }
        $("#loginBtn2").css('color', '#555555')
        $('#loginBtn2').attr('disabled', "true");
    })
    $("#getCode").click(function () {
        $.ajax({
            url: "/common/sendCode",
            type: "post",
            cache: false,
            global: false,
            dataType: "json",
            data: {
                mobile: $("#fuPhone").val(),
                type: "mobile_login"
            },
            success: function (json) {
                if (json.success) {
                    alert("验证码发送成功")
                    $("#getCode").attr("disabled", "disabled");
                    var time = 60;
                    var set = setInterval(function () {
                        $("#getCode").html(--time + " s");
                    }, 1000);

                    setTimeout(function () {
                        $("#getCode").attr("disabled", false).html("重新获取");
                        clearInterval(set);
                    }, 60000);
                } else {
                    alert(json.msg)
                }
            }
        })
    });
    $("#scCode").on("input", function (e) {
        console.log()
        if (e.delegateTarget.value.length == 6) {
            $.ajax({
                url: "/common/checkCode",
                type: "post",
                cache: false,
                global: false,
                dataType: "json",
                data: {
                    code: e.delegateTarget.value,
                },
                success: function (json) {
                    if (json.success) {
                        $('#loginBtn2').removeAttr("disabled");
                    } else {
                        alert(json.msg)
                    }
                }
            })
        }
    })
</script>
#end
